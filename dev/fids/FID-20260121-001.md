# FID-20260121-001: Sync Command

**Status:** COMPLETED
**Priority:** HIGH
**Complexity:** 3
**Created:** 2026-01-21
**Completed:** 2026-01-21
**Estimated:** 2h
**Actual:** ~10m

## Description
Implement the `/sync` command to link Discord guild members to website profiles. This command will fetch members from the Discord server, send them to the game backend, and store the returned mappings in the bot's database.

## Requirements
- [x] `/sync` slash command (admin only)
- [x] Fetch all members from the Discord guild
- [x] Batch send members to `POST /api/discord/sync`
- [x] Handle API authentication using `DISCORD_BOT_API_TOKEN`
- [x] Store matched user mappings in SQLite database (`users` table)
- [x] Provide a summary report to the user (Matched, Unmatched, Updated)
- [x] Handle large guilds with batching (chunk size 1000-5000)

## Implementation Approach
1.  **Database Schema**: Add a `users` table to store Discord ID -> Game Profile mapping.
2.  **API Service**: Add `syncDiscordUsers` function to `src/services/corporateWarfareApi.js`.
3.  **Repository**: Create `src/database/repositories/userRepository.js` to handle database operations.
4.  **Command**: Create `src/commands/admin/sync.js`.

## Files Created/Modified
- `src/database/schema.js` (Modify: Add `users` table)
- `src/services/corporateWarfareApi.js` (Modify: Add sync endpoint)
- `src/database/repositories/userRepository.js` (Create)
- `src/database/repositories/index.js` (Modify: Export userRepository)
- `src/commands/admin/sync.js` (Create)
- `src/config/config.js` (Modify: Add token)

## Dependencies
- `src/services/corporateWarfareApi.js`
- `src/database/index.js`

## Notes
- Ensure `DISCORD_BOT_API_TOKEN` is in `.env` and `config.js`.
- Respect rate limits and API batch sizes.
